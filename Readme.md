# Интернет-магазин на базе Django и Vue3

### Основные технологии

* Frontend: HTML5, CSS3, JS, Vue3
* Backend: python 3.10, django 4.2, django rest framework 3.14
* Работа с данными реализована в СУБД PostgreSQL 15.2

### Особенности

* Структура базы данных доступна по [ссылке](misc/img/database.png)
* Frontend и backend приложения сообщаются посредством АПИ, написанном на DRF
* Основные get-роуты АПИ кэшируются в локальной памяти
* В админке возможны создание, просмотр, редактирование, удаление и деактивация
  (soft-delete)  сущностей:
    * продукты и связанные с ними спецификации, тэги, отзывы, акции
    * категории, подкатегории
    * пользователи, в том числе с правами администратора
    * заказы, оплаты
* Корзина пользователя реализована через сессию браузера, до момента
  оформления заказа информация о нем не добавляется и не хранится в БД.
* Обращение сайта к АПИ посредством установки хедера в запросы (
  X-HERE-I-AM)

### Структура репозитория

* `misc/` - каталог с файлами, необходимыми для отображения документации
* `requirements/` - каталог с файлами, содержащими список зависимостей
* `shop/` - каталог с самим Django-проектом
* `.env.template` - шаблон для объявления переменных среды
* `demo.sh` - скрипт для запуска демонстрации
* `swagger.yaml` - контракт АПИ

### Инструкция по демонстрационному развертыванию

Вероятно, вы можете захотеть воспользоваться
[скриптом для установки и запуска](#установка-с-помощью-скрипта)

ВНИМАНИЕ! Инструкция ниже написана для пользователей Unix-подобных ОС,
все команды должны запускаться в терминале. Предполагается, что на начало
установки вы находитесь в корне проекта

1. Скопируйте репозиторий.
2. Переименуйте файл [.env.template](.env.template) в `.env`,
   заполните его по шаблону.

3. Установите зависимости.
    ```shell
    pip install -r requirements/base.pip
    ```
4. Перейдите в корень проекта
    ```shell
   cd shop/
   ```
5. Запустите [PostgreSQL](#запуск-субд-postrgesql) или вашу любимую СУБД
   (во втором случае необходимо
   изменить [настройки](shop/backend/settings.py#L125))

6. Примените миграции

   **ВНИМАНИЕ! Перед выполнением следующих команд убедитесь, что ваша база
   данных готова для работы (см. п.6)**
    ```shell
    python manage.py migrate
    ```

7. **!В разработке**

   Создайте немного демонстрационного контента, загрузив фикстуры
    ```shell
   python manage.py loaddata fixtures/data.json
   ```
   При этом в БД появятся:
    * каталоги
    * продукция с обзорами, спецификациями, тэгами
    * супер-пользователь с логином и паролем admin
    * три обычных пользователя с паролем 123456 (user1, user2, user3)

8. И, наконец, запустите тестовый сервер Django
    ```shell
   python manage.py runserver
   ```

9. Сайт доступен по адресу http://localhost:8000/
10. Администраторский раздел http://localhost:8000/admin/

### Запуск СУБД PostrgeSQL

Предполагается, что у вас уже установлен
[docker](https://docs.docker.com/desktop/install/linux-install/)

1. Из корня проекта перейдите в каталог `postgres`
    ```shell
   cd shop/postgres/
   ```
2. Введите команды
    ```shell
   docker compose build
   docker compose up -d
   ```

   В результате будет запущена СУБД PostgreSQL по адресу
   http://localhost:5432/
3. Не забудьте вернуться на уровень выше
    ```shell
   cd ..
   ```

[Вернуться к инструкции](#инструкция-по-демонстрационному-развертыванию)

### Установка с помощью скрипта

1. Запустите скрипт demo.sh из корня проекта
    ```shell 
    source demo.sh
    ```
   Все настройки будут сделаны автоматически (вам все еще будет нужен
   предварительно установленный docker)

2. Сайт доступен по адресу http://localhost:8000/
3. Администраторский раздел http://localhost:8000/admin/